---
phase: 02-infrastructure-setup
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - foundry.toml
  - .env.example.arbitrum-sepolia
  - .gitignore
  - deployments/README.md
autonomous: true

must_haves:
  truths:
    - "forge script script/Deploy.s.sol --fork-url arbitrum-sepolia-rpc succeeds in dry-run mode"
    - "Deploy.s.sol reads Arbitrum-specific protocol addresses from environment variables"
    - "Deployment artifact template exists for chain ID 421614"
    - ".env.arbitrum-sepolia is gitignored (secrets never committed)"
    - ".env.example.arbitrum-sepolia has placeholder values (no real secrets)"
    - "foundry.toml has arbitrum-sepolia RPC endpoint configured"
    - "Existing Ethereum/Sepolia deployment pipeline is unaffected"
  artifacts:
    - path: "foundry.toml"
      provides: "Arbitrum Sepolia RPC endpoint and Arbiscan etherscan config"
      contains: "arbitrum-sepolia"
    - path: ".env.example.arbitrum-sepolia"
      provides: "Template for Arbitrum Sepolia deployment environment variables"
      contains: "AAVE_V3_POOL"
    - path: ".gitignore"
      provides: "Security: chain-specific .env files are gitignored"
      contains: ".env.arbitrum"
  key_links:
    - from: ".env.example.arbitrum-sepolia"
      to: "contracts/script/Deploy.s.sol"
      via: "environment variable names match Deploy.s.sol vm.envAddress calls"
      pattern: "AAVE_V3_POOL|BALANCER_VAULT|UNISWAP_V2_ROUTER|UNISWAP_V3_ROUTER|UNISWAP_V3_QUOTER"
    - from: "foundry.toml"
      to: "contracts/script/Deploy.s.sol"
      via: "RPC endpoint used by forge script --rpc-url"
      pattern: "arbitrum-sepolia"
---

<objective>
Prepare the Foundry deployment infrastructure for Arbitrum Sepolia: add RPC endpoints to foundry.toml, create environment variable templates with correct Arbitrum protocol addresses, and ensure secrets are gitignored. Verify existing Deploy.s.sol works with Arbitrum addresses via dry-run.

Purpose: Satisfy DEPLOY-01 through DEPLOY-04. The existing Deploy.s.sol is already multi-chain ready (uses env vars), so this plan focuses on configuration, not code changes. After this plan, deploying to Arbitrum Sepolia requires only: (1) fill in real secrets in `.env.arbitrum-sepolia`, (2) fund deployer wallet with testnet ETH, (3) run `forge script`.

Output: Deployment-ready configuration files for Arbitrum Sepolia.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-infrastructure-setup/02-RESEARCH.md
@.planning/phases/01-chain-research/ARBITRUM.md
@contracts/script/Deploy.s.sol
@foundry.toml
@deployments/11155111.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure foundry.toml for Arbitrum Sepolia and create env template</name>
  <files>
    foundry.toml
    .env.example.arbitrum-sepolia
    .gitignore
  </files>
  <action>
    **1. Update foundry.toml:**

    Add `arbitrum-sepolia` to `[rpc_endpoints]` section:
    ```toml
    arbitrum-sepolia = "${ARBITRUM_SEPOLIA_RPC_URL}"
    ```

    Add `[etherscan]` section for contract verification on Arbiscan:
    ```toml
    [etherscan]
    mainnet = { key = "${ETHERSCAN_API_KEY}" }
    sepolia = { key = "${ETHERSCAN_API_KEY}" }
    arbitrum = { key = "${ARBISCAN_API_KEY}" }
    arbitrum-sepolia = { key = "${ARBISCAN_API_KEY}" }
    ```

    Keep ALL existing config unchanged. Only ADD new entries.

    **2. Create `.env.example.arbitrum-sepolia`:**

    Template with ALL variables required by Deploy.s.sol (matching `vm.envAddress` and `vm.envUint` calls), populated with correct Arbitrum Sepolia protocol addresses from Phase 1 research:

    ```
    # Arbitrum Sepolia Deployment Configuration
    # Copy to .env.arbitrum-sepolia and fill in secrets

    # Deployer (CHANGE THESE - never commit real values)
    DEPLOYER_PRIVATE_KEY=YOUR_PRIVATE_KEY_HERE
    BOT_WALLET_ADDRESS=YOUR_BOT_WALLET_ADDRESS_HERE

    # RPC
    ARBITRUM_SEPOLIA_RPC_URL=https://sepolia-rollup.arbitrum.io/rpc
    RPC_URL=https://sepolia-rollup.arbitrum.io/rpc
    CHAIN_ID=421614

    # Protocol Addresses (Arbitrum Sepolia - verified from official docs)
    AAVE_V3_POOL=0x794a61358D6845594F94dc1DB02A252b5b4814aD
    BALANCER_VAULT=0xBA12222222228d8Ba445958a75a0704d566BF2C8
    UNISWAP_V2_ROUTER=0x1b02dA8Cb0d097eB8D57A175b88c7D8b47997506
    UNISWAP_V3_ROUTER=0x68b3465833fb72A70ecDF485E0e4C7bD8665Fc45
    UNISWAP_V3_QUOTER=0xEd1f6473345F45b75F8179591dd5bA1888cf2FB3

    # Safety Parameters (adjusted for Arbitrum L2 gas model)
    MIN_PROFIT_WEI=10000000000000000
    MAX_GAS_PRICE=100000000
    MAX_TRADE_SIZE=1000000000000000000000
    FAILURE_THRESHOLD=5

    # Contract Verification
    ARBISCAN_API_KEY=YOUR_ARBISCAN_API_KEY_HERE
    ```

    IMPORTANT SECURITY RULES:
    - Use `YOUR_*_HERE` placeholders for all secrets
    - Protocol addresses CAN be included (they are public, on-chain data)
    - `DEPLOYER_PRIVATE_KEY` and `BOT_WALLET_ADDRESS` MUST be placeholders
    - `ARBISCAN_API_KEY` MUST be placeholder

    NOTE on addresses:
    - AAVE_V3_POOL: `0x794a61358D6845594F94dc1DB02A252b5b4814aD` (same on all chains via CREATE2, confirmed in ARBITRUM.md)
    - BALANCER_VAULT: `0xBA12222222228d8Ba445958a75a0704d566BF2C8` (same via CREATE2, used in existing Sepolia deployment)
    - UNISWAP_V2_ROUTER: Using SushiSwap V2 router `0x1b02dA8Cb0d097eB8D57A175b88c7D8b47997506` (Uniswap V2 fork on Arbitrum)
    - UNISWAP_V3_ROUTER: `0x68b3465833fb72A70ecDF485E0e4C7bD8665Fc45` (SwapRouter02, confirmed in ARBITRUM.md)
    - UNISWAP_V3_QUOTER: `0xEd1f6473345F45b75F8179591dd5bA1888cf2FB3` (QuoterV2, same via CREATE2)

    **3. Update `.gitignore`:**

    Add chain-specific env files to the gitignore. Under the existing `.env` section, add:
    ```
    .env.arbitrum-sepolia
    .env.arbitrum
    .env.base-sepolia
    .env.base
    ```

    This ensures chain-specific env files with real secrets are never committed. The `.env.example.*` files (with placeholders) are safe to commit.
  </action>
  <verify>
    1. `grep "arbitrum-sepolia" foundry.toml` shows RPC endpoint entry
    2. `grep "AAVE_V3_POOL" .env.example.arbitrum-sepolia` shows correct address
    3. `grep "YOUR_PRIVATE_KEY_HERE" .env.example.arbitrum-sepolia` confirms no real secrets
    4. `grep ".env.arbitrum" .gitignore` shows gitignore entry
    5. `gitleaks detect --source . --no-git` passes (no leaked secrets)
    6. `forge test` passes (foundry.toml changes don't break existing tests)
  </verify>
  <done>
    - foundry.toml has `arbitrum-sepolia` RPC endpoint and etherscan config for Arbiscan
    - `.env.example.arbitrum-sepolia` exists with all Deploy.s.sol required variables using correct Arbitrum addresses
    - All secret values are placeholders (YOUR_*_HERE)
    - `.gitignore` blocks `.env.arbitrum-sepolia` and other chain-specific env files
    - No secrets leaked (gitleaks clean)
    - Existing tests still pass
  </done>
</task>

<task type="auto">
  <name>Task 2: Update deployments README and verify Deploy.s.sol Arbitrum compatibility</name>
  <files>
    deployments/README.md
  </files>
  <action>
    **1. Update `deployments/README.md`:**

    Add Arbitrum Sepolia to the deployment artifact documentation. Update the README to reflect multi-chain deployment support:

    ```markdown
    # Deployment Artifacts

    Contract deployment records per chain. Each file is named `{chainId}.json`.

    ## Deployed Chains

    | Chain ID | Network | Status | File |
    |----------|---------|--------|------|
    | 11155111 | Sepolia (Ethereum testnet) | Deployed | `11155111.json` |
    | 421614 | Arbitrum Sepolia (testnet) | Pending | `421614.json` |
    | 1 | Ethereum Mainnet | Not deployed | `1.json` |
    | 42161 | Arbitrum One (mainnet) | Not deployed | `42161.json` |

    ## Deployment Commands

    ### Ethereum Sepolia
    ```bash
    source .env.sepolia && forge script script/Deploy.s.sol \
      --rpc-url $SEPOLIA_RPC_URL --broadcast --verify
    ```

    ### Arbitrum Sepolia
    ```bash
    source .env.arbitrum-sepolia && forge script script/Deploy.s.sol \
      --rpc-url $ARBITRUM_SEPOLIA_RPC_URL --broadcast --verify \
      --etherscan-api-key $ARBISCAN_API_KEY
    ```

    ## Artifact Format

    Each `{chainId}.json` contains:
    - `chainId`: Network chain ID
    - `network`: Human-readable network name
    - `deployedAt`: Unix timestamp of deployment
    - `blockNumber`: Block number at deployment
    - `contracts`: Deployed contract addresses
    - `configuration`: Protocol addresses used as constructor args
    ```

    **2. Verify Deploy.s.sol compatibility with Arbitrum:**

    The existing `Deploy.s.sol` already supports Arbitrum via:
    - `getChainName(421614)` returns `"arbitrum-sepolia"` (line 133)
    - `getChainName(42161)` returns `"arbitrum"` (line 129)
    - All addresses loaded from env vars (not hardcoded)
    - Export path uses `vm.toString(chain.chainId)` (works for any chain ID)

    NO code changes needed to Deploy.s.sol. This task verifies and documents this fact.

    To verify: run `forge build` to ensure contracts compile, then confirm the getChainName mapping exists:
    ```bash
    forge build
    grep -n "421614\|arbitrum" contracts/script/Deploy.s.sol
    ```
  </action>
  <verify>
    1. `forge build` succeeds (contracts compile)
    2. `forge test` passes (no regressions)
    3. `grep "421614" contracts/script/Deploy.s.sol` shows Arbitrum Sepolia chain ID handling
    4. `cat deployments/README.md` shows Arbitrum Sepolia deployment commands
  </verify>
  <done>
    - `deployments/README.md` documents Arbitrum Sepolia deployment status and commands
    - Deploy.s.sol confirmed compatible with Arbitrum (getChainName handles 421614 and 42161)
    - `forge build` and `forge test` pass
    - Deployment workflow documented: source env, forge script, verify on Arbiscan
  </done>
</task>

</tasks>

<verification>
1. `forge build` — Solidity contracts compile
2. `forge test` — All Foundry tests pass (no regressions from foundry.toml changes)
3. `gitleaks detect --source . --no-git` — No secrets detected
4. `grep "arbitrum-sepolia" foundry.toml` — RPC endpoint configured
5. `grep "DEPLOYER_PRIVATE_KEY=YOUR" .env.example.arbitrum-sepolia` — Template has placeholders only
6. `grep ".env.arbitrum" .gitignore` — Chain env files are gitignored
7. `grep "421614" contracts/script/Deploy.s.sol` — Deploy.s.sol handles Arbitrum Sepolia
</verification>

<success_criteria>
- foundry.toml has Arbitrum Sepolia RPC endpoint and Arbiscan etherscan config
- `.env.example.arbitrum-sepolia` has correct Arbitrum protocol addresses with placeholder secrets
- `.gitignore` prevents committing `.env.arbitrum-sepolia` (and other chain env files)
- Deploy.s.sol confirmed compatible with Arbitrum chain IDs (no code changes needed)
- `deployments/README.md` documents multi-chain deployment workflow
- All existing tests pass, no secrets leaked
</success_criteria>

<output>
After completion, create `.planning/phases/02-infrastructure-setup/02-02-SUMMARY.md`
</output>
