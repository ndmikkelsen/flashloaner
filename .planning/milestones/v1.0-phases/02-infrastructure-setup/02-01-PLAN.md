---
phase: 02-infrastructure-setup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - bot/src/config/chains/types.ts
  - bot/src/config/chains/ethereum.ts
  - bot/src/config/chains/sepolia.ts
  - bot/src/config/chains/arbitrum.ts
  - bot/src/config/chains/arbitrum-sepolia.ts
  - bot/src/config/chains/index.ts
  - bot/src/config/chains/pools/arbitrum-mainnet.ts
  - bot/src/config/chains/pools/arbitrum-sepolia.ts
  - bot/src/config/index.ts
  - bot/src/config/defaults.ts
autonomous: true

must_haves:
  truths:
    - "loadChainConfig(42161) returns Arbitrum mainnet config with correct addresses"
    - "loadChainConfig(421614) returns Arbitrum Sepolia config with correct addresses"
    - "loadChainConfig(1) returns Ethereum mainnet config preserving existing behavior"
    - "loadChainConfig(11155111) returns Sepolia config preserving existing behavior"
    - "Adding a new chain requires only a new chain config file and a switch case entry"
    - "Existing MAINNET_TOKENS, SEPOLIA_TOKENS, MAINNET_POOLS exports still work unchanged"
  artifacts:
    - path: "bot/src/config/chains/types.ts"
      provides: "ChainConfig interface with chain-specific addresses, gas params, MEV config"
      contains: "interface ChainConfig"
    - path: "bot/src/config/chains/index.ts"
      provides: "loadChainConfig function that selects config by chainId"
      exports: ["loadChainConfig"]
    - path: "bot/src/config/chains/arbitrum-sepolia.ts"
      provides: "Arbitrum Sepolia testnet configuration"
      contains: "421614"
    - path: "bot/src/config/chains/arbitrum.ts"
      provides: "Arbitrum mainnet configuration"
      contains: "42161"
  key_links:
    - from: "bot/src/config/chains/index.ts"
      to: "bot/src/config/chains/arbitrum-sepolia.ts"
      via: "switch on chainId"
      pattern: "case 421614"
    - from: "bot/src/config/chains/types.ts"
      to: "bot/src/config/types.ts"
      via: "imports PoolDefinition, MonitorConfig, DetectorConfig"
      pattern: "import.*from.*types"
---

<objective>
Create a chain-specific configuration system that separates chain addresses, gas parameters, DEX configs, and pool definitions from the shared bot logic. Each chain gets its own config file; the config loader selects by chainId at runtime.

Purpose: Satisfy REPO-01 (chain config separated from shared logic), REPO-02 (adding a chain = adding config files), and REPO-03 (Ethereum config continues working). This is the foundation for multi-chain bot operation.

Output: Chain config module at `bot/src/config/chains/` with configs for Ethereum, Sepolia, Arbitrum, and Arbitrum Sepolia.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-infrastructure-setup/02-RESEARCH.md
@.planning/phases/01-chain-research/ARBITRUM.md
@bot/src/config/types.ts
@bot/src/config/defaults.ts
@bot/src/config/pools.ts
@bot/src/config/index.ts
@bot/src/config/validate.ts
@bot/src/run-testnet.ts
@bot/src/monitor/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ChainConfig type and chain-specific config files</name>
  <files>
    bot/src/config/chains/types.ts
    bot/src/config/chains/ethereum.ts
    bot/src/config/chains/sepolia.ts
    bot/src/config/chains/arbitrum.ts
    bot/src/config/chains/arbitrum-sepolia.ts
    bot/src/config/chains/index.ts
    bot/src/config/chains/pools/arbitrum-mainnet.ts
    bot/src/config/chains/pools/arbitrum-sepolia.ts
  </files>
  <action>
    Create `bot/src/config/chains/types.ts` with a `ChainConfig` interface:
    ```typescript
    interface ChainConfig {
      chainId: number;
      chainName: string;
      // RPC
      rpcUrl: string;          // loaded from env at runtime
      fallbackRpcUrl?: string;  // optional fallback
      // Protocol addresses
      protocols: {
        aaveV3Pool: string;
        balancerVault: string;
      };
      // DEX configuration
      dexes: {
        uniswapV3?: { factory: string; router: string; quoter: string; };
        uniswapV2?: { router: string; factory: string; };
        sushiswapV2?: { router: string; factory: string; };
        camelot?: { router: string; factory: string; };
      };
      // Token addresses
      tokens: Record<string, string>;
      // Gas parameters
      gas: {
        maxGasPriceGwei: number;
        gasPerSwap: number;
      };
      // Monitor and detector overrides
      monitor: MonitorConfig;
      detector: DetectorConfig;
      // MEV configuration
      mev: MEVProtectionConfig;
      // Pool definitions for this chain
      pools: PoolDefinition[];
    }
    ```

    Import `MonitorConfig`, `DetectorConfig`, `PoolDefinition` from `../types.js` and `MEVProtectionConfig` from `../../mev/types.js`.

    Create `ethereum.ts`: Extract existing `MAINNET_TOKENS` values, `DEFAULT_MONITOR`, `DEFAULT_DETECTOR`, `MAINNET_MEV_CONFIG` from defaults.ts, and `MAINNET_POOLS` from pools.ts into a single `ETHEREUM_CONFIG: ChainConfig`. Use well-known mainnet addresses:
    - Aave V3 Pool: `0x87870Bca3F3fD6335C3F4ce8392D69350B4fA4E2`
    - Balancer Vault: `0xBA12222222228d8Ba445958a75a0704d566BF2C8`
    - Uniswap V2 Router: `0x7a250d5630B4cF539739dF2C5dAcb4c659F2488D`
    - Uniswap V3 Router: `0x68b3465833fb72A70ecDF485E0e4C7bD8665Fc45`
    - Uniswap V3 Quoter: `0x61fFE014bA17989E743c5F6cB21bF9697530B21e` (QuoterV2)
    - Uniswap V3 Factory: `0x1F98431c8aD98523631AE4a59f267346ea31F984`
    - SushiSwap V2 Router: `0xd9e1cE17f2641f24aE83637ab66a2cca9C378B9F`

    Create `sepolia.ts`: Extract existing `SEPOLIA_TOKENS`, `SEPOLIA_MONITOR`, `SEPOLIA_DETECTOR` from defaults.ts. Use addresses from existing `deployments/11155111.json` configuration section.

    Create `arbitrum.ts`: Arbitrum mainnet config using addresses from Phase 1 research (ARBITRUM.md):
    - chainId: 42161
    - Aave V3 Pool: `0x794a61358D6845594F94dc1DB02A252b5b4814aD`
    - Uniswap V3 Factory: `0x1F98431c8aD98523631AE4a59f267346ea31F984`
    - Uniswap V3 Router (SwapRouter02): `0x68b3465833fb72A70ecDF485E0e4C7bD8665Fc45`
    - SushiSwap V2 Router: `0x1b02dA8Cb0d097eB8D57A175b88c7D8b47997506`
    - SushiSwap V2 Factory: `0xc35DADB65012eC5796536bD9864eD8773aBc74C4`
    - WETH: `0x82af49447d8a07e3bd95bd0d56f35241523fbab1`
    - USDC: `0xFF970A61A04b1cA14834A43f5dE4533eBDDB5CC8`
    - USDT: `0xfd086bc7cd5c481dcc9c85ebe478a1c0b69fcbb9`
    - Gas: maxGasPriceGwei=0.1, gasPerSwap=150000
    - Monitor: pollIntervalMs=1000 (Arbitrum 0.25s blocks = faster polling)
    - MEV mode: "none" (no Flashbots on Arbitrum, FCFS ordering)
    - Balancer Vault: TBD placeholder `0x0000000000000000000000000000000000000000` (resolve during Phase 3)

    Create `arbitrum-sepolia.ts`: Arbitrum Sepolia testnet config:
    - chainId: 421614
    - Aave V3 Pool: `0x794a61358D6845594F94dc1DB02A252b5b4814aD` (same via CREATE2)
    - Uniswap V3 Factory/Router: same addresses as mainnet (CREATE2)
    - Camelot Router: `0x171B925C51565F5D2a7d8C494ba3188D304EFD93`
    - Camelot Factory: `0x18E621B64d7808c3C47bccbbD7485d23F257D26f`
    - Gas: maxGasPriceGwei=0.1, gasPerSwap=150000
    - Monitor: deltaThresholdPercent=0.01, pollIntervalMs=1000
    - Detector: minProfitThreshold=0.0001, defaultInputAmount=1 (testnet values)
    - MEV mode: "none"
    - Pools: empty initially (will be populated when testnet pools are discovered)

    Create `bot/src/config/chains/pools/arbitrum-mainnet.ts`:
    - Define pools for Arbitrum mainnet using ARBITRUM.md addresses:
      - WETH/USDC UniV3 0.05% pool: `0xC31E54c7a869B9FcBEcc14363CF510d1c41fa443`
      - WETH/USDT UniV3 0.05% pool: `0x641c00a822e8b671738d32a431a4fb6074e5c79d`
    - Use `PoolDefinition` type from `../../types.js`

    Create `bot/src/config/chains/pools/arbitrum-sepolia.ts`:
    - Export empty array (testnet pools TBD, discovered during Phase 4)
    - Add comment explaining pools will be populated after deployment

    Create `bot/src/config/chains/index.ts`:
    - Import all chain configs
    - Export `loadChainConfig(chainId?: number): ChainConfig` that reads `CHAIN_ID` from env if not provided
    - Switch on chainId: 1 -> ethereum, 11155111 -> sepolia, 42161 -> arbitrum, 421614 -> arbitrum-sepolia
    - Throw descriptive error for unsupported chain IDs listing supported ones
    - Re-export `ChainConfig` type

    IMPORTANT: Do NOT modify existing exports from `bot/src/config/defaults.ts` or `bot/src/config/pools.ts` — they must remain backward-compatible. The new chain config system supplements, not replaces, existing config.
  </action>
  <verify>
    1. `pnpm test` passes (existing tests still work with unchanged exports)
    2. TypeScript compiles without errors: `cd bot && npx tsc --noEmit`
    3. Check imports resolve: `grep -r "from.*chains" bot/src/config/chains/`
  </verify>
  <done>
    - `ChainConfig` interface exists with all required fields
    - 4 chain config files exist (ethereum, sepolia, arbitrum, arbitrum-sepolia) with correct addresses from research
    - `loadChainConfig()` function exists and switches on chainId
    - Arbitrum config has correct gas parameters (maxGasPriceGwei=0.1, fast polling)
    - Existing `MAINNET_TOKENS`, `SEPOLIA_TOKENS`, `MAINNET_POOLS` exports unchanged
    - TypeScript compiles, all tests pass
  </done>
</task>

<task type="auto">
  <name>Task 2: Update config index exports and add chain config to validate.ts</name>
  <files>
    bot/src/config/index.ts
  </files>
  <action>
    Update `bot/src/config/index.ts` to re-export the new chain config system:
    - Add: `export { loadChainConfig } from "./chains/index.js";`
    - Add: `export type { ChainConfig } from "./chains/types.js";`

    This makes the chain config accessible from the standard config import path:
    ```typescript
    import { loadChainConfig, type ChainConfig } from "./config/index.js";
    ```

    Keep ALL existing exports unchanged (backward compatibility is critical).

    Do NOT modify `validate.ts` — the existing `parseEnv`/`buildConfig`/`validateConfig` functions remain as-is for backward compatibility. The chain config system is additive.
  </action>
  <verify>
    1. `pnpm test` passes
    2. Verify exports: `grep "export" bot/src/config/index.ts` shows both old and new exports
    3. TypeScript compiles: `cd bot && npx tsc --noEmit`
  </verify>
  <done>
    - `loadChainConfig` and `ChainConfig` are exported from `bot/src/config/index.ts`
    - All previous exports still present and unchanged
    - TypeScript compiles without errors
    - All existing tests pass
  </done>
</task>

</tasks>

<verification>
1. `pnpm test` — All existing TypeScript tests pass (no regressions)
2. `cd bot && npx tsc --noEmit` — TypeScript compiles cleanly
3. Verify chain config files exist: `ls bot/src/config/chains/`
4. Verify backward compatibility: `grep "MAINNET_TOKENS\|SEPOLIA_TOKENS\|MAINNET_POOLS" bot/src/config/index.ts` shows unchanged exports
5. Verify Arbitrum addresses match research: `grep "0x794a61358D6845594F94dc1DB02A252b5b4814aD" bot/src/config/chains/arbitrum.ts` (Aave pool)
</verification>

<success_criteria>
- Chain config loader returns correct config for all 4 supported chain IDs (1, 11155111, 42161, 421614)
- Arbitrum configs use addresses from Phase 1 research (ARBITRUM.md)
- Existing bot config exports (`MAINNET_TOKENS`, `SEPOLIA_TOKENS`, `MAINNET_POOLS`, etc.) work unchanged
- Adding a hypothetical new chain (e.g., Base) would require only: 1 new chain config file + 1 switch case entry
- All tests pass, TypeScript compiles
</success_criteria>

<output>
After completion, create `.planning/phases/02-infrastructure-setup/02-01-SUMMARY.md`
</output>
