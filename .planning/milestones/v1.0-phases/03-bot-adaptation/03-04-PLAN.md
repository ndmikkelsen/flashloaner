---
phase: 03-bot-adaptation
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - bot/src/config/chains/pools/arbitrum-sepolia.ts
  - bot/src/config/chains/arbitrum-sepolia.ts
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "ARBITRUM_SEPOLIA_POOLS contains zero TBD_DISCOVER_ON_CHAIN placeholder strings"
    - "Every poolAddress in ARBITRUM_SEPOLIA_POOLS is either a valid 0x-prefixed 42-character Ethereum address or the array is empty with a documented reason"
    - "Every token1 address in ARBITRUM_SEPOLIA_POOLS is a real ERC-20 token address (not 0x...0001)"
    - "tokens.USDC in ARBITRUM_SEPOLIA_CONFIG is either a real address or removed (not zero address placeholder)"
  artifacts:
    - path: "bot/src/config/chains/pools/arbitrum-sepolia.ts"
      provides: "Pool definitions with real or validated addresses"
      contains: "ARBITRUM_SEPOLIA_POOLS"
    - path: "bot/src/config/chains/arbitrum-sepolia.ts"
      provides: "Updated token addresses"
      contains: "ARBITRUM_SEPOLIA_CONFIG"
  key_links:
    - from: "bot/src/config/chains/pools/arbitrum-sepolia.ts"
      to: "bot/src/config/chains/arbitrum-sepolia.ts"
      via: "import ARBITRUM_SEPOLIA_POOLS"
      pattern: "import.*ARBITRUM_SEPOLIA_POOLS"
---

<objective>
Discover real Uniswap V3 pool addresses on Arbitrum Sepolia and replace TBD_DISCOVER_ON_CHAIN placeholders in the pool config file.

Purpose: Close the single blocking gap from Phase 3 verification — both pool entries have placeholder addresses that prevent PriceMonitor from fetching prices, which blocks opportunity detection (SC-3) and dry-run reporting (SC-5).

Output: Updated `bot/src/config/chains/pools/arbitrum-sepolia.ts` with real pool addresses (or an empty array with documentation if no pools exist on testnet), and updated token addresses in `arbitrum-sepolia.ts`.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-bot-adaptation/03-01-SUMMARY.md
@.planning/phases/03-bot-adaptation/03-VERIFICATION.md
@bot/src/config/chains/pools/arbitrum-sepolia.ts
@bot/src/config/chains/arbitrum-sepolia.ts
@bot/src/config/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Discover pool addresses on Arbitrum Sepolia and update pool config</name>
  <files>bot/src/config/chains/pools/arbitrum-sepolia.ts, bot/src/config/chains/arbitrum-sepolia.ts</files>
  <action>
    Use `cast call` to query the Uniswap V3 factory on Arbitrum Sepolia for real pool addresses. The RPC URL is in the `.env.arbitrum-sepolia` file as `RPC_URL`. Load it with: `set -a && source .env.arbitrum-sepolia && set +a`

    **Step 1: Discover testnet token addresses**

    Well-known testnet tokens on Arbitrum Sepolia to try (from Uniswap deployment docs and Arbiscan):
    - WETH: `0x980B62Da83eFf3D4576C647993b0c1D7faf17c73` (confirmed)
    - Try common USDC candidates seen on Arbiscan Sepolia: `0x75faf114eafb1BDbe2F0316DF893fd58CE46AA4d` (Aave testnet USDC on Arb Sepolia)

    Also try querying for pools with just WETH paired against ANY known token. Use `cast call` to test each candidate:

    ```bash
    # Load RPC URL
    set -a && source .env.arbitrum-sepolia && set +a

    # Factory address
    FACTORY=0x248AB79Bbb9bC29bB72f7Cd42F17e054Fc40188e
    WETH=0x980B62Da83eFf3D4576C647993b0c1D7faf17c73

    # Try known Arbitrum Sepolia USDC candidates
    # Aave testnet USDC
    USDC_AAVE=0x75faf114eafb1BDbe2F0316DF893fd58CE46AA4d

    # Query all fee tiers for each token pair
    for TOKEN in $USDC_AAVE; do
      for FEE in 500 3000 10000; do
        RESULT=$(cast call $FACTORY "getPool(address,address,uint24)(address)" $WETH $TOKEN $FEE --rpc-url $RPC_URL 2>/dev/null)
        echo "WETH/$TOKEN fee=$FEE => $RESULT"
      done
    done
    ```

    If the Aave USDC doesn't yield pools, also try these strategies:
    - Query Arbiscan Sepolia API for recently created Uniswap V3 pools (if cast can query events)
    - Try `cast call` on the factory with `getPool` using different token addresses found from Uniswap V3 testnet documentation
    - Try the Uniswap testnet USDC if different from Aave: look at the Uniswap V3 Arbitrum Sepolia deployment docs

    **Step 2: Update pool config file**

    Based on discovery results, update `bot/src/config/chains/pools/arbitrum-sepolia.ts`:

    **If pools ARE found:**
    - Replace `poolAddress: "TBD_DISCOVER_ON_CHAIN"` with the discovered `0x...` addresses
    - Replace `token1: "0x0000000000000000000000000000000000000001"` with the real token address
    - Update the label to reflect the actual token pair (e.g., if USDC instead of UNI, change label accordingly)
    - Update `decimals1` if the token uses different decimals (USDC = 6 decimals, not 18)
    - Keep the helpful discovery documentation comments at the top of the file

    **If NO pools are found** (zero address returned for all queries):
    - Set `ARBITRUM_SEPOLIA_POOLS` to an empty array `[]`
    - Add a detailed comment block explaining: which token/fee combinations were queried, when, what was returned, and that Arbitrum Sepolia testnet has no organic Uniswap V3 liquidity
    - Note that Phase 4 testnet validation may need to deploy test pools or use Arbitrum mainnet fork instead
    - This is an acceptable outcome — it closes the gap by replacing invalid placeholders with a known-empty state that the bot handles gracefully (the `run-arb-sepolia.ts` already warns when pools array is empty)

    **Step 3: Update chain config token addresses**

    In `bot/src/config/chains/arbitrum-sepolia.ts`:
    - If a real USDC was found in pools, update `tokens.USDC` from `0x000...0` to the real address
    - If USDT was found, update `tokens.USDT` similarly
    - Remove any token entries that are still zero-address placeholders — it's better to omit than to have invalid addresses. Change from:
      ```typescript
      USDC: "0x0000000000000000000000000000000000000000", // TBD
      USDT: "0x0000000000000000000000000000000000000000", // TBD
      ```
      To either real addresses or remove the entries entirely (keep only WETH if others are unknown).

    **Important constraints:**
    - NEVER commit real RPC API keys or endpoint URLs
    - The `.env.arbitrum-sepolia` file is gitignored and must not be committed
    - All addresses in source code must be checksummed (mixed-case) or lowercase hex — cast returns lowercase, which is fine
    - The `PoolDefinition` type requires: label, dex, poolAddress, token0, token1, decimals0, decimals1, feeTier (optional)
  </action>
  <verify>
    1. `grep -c "TBD_DISCOVER_ON_CHAIN" bot/src/config/chains/pools/arbitrum-sepolia.ts` returns 0
    2. `grep -c "0x0000000000000000000000000000000000000001" bot/src/config/chains/pools/arbitrum-sepolia.ts` returns 0
    3. `npx tsc --noEmit` compiles cleanly (TypeScript types still valid)
    4. `pnpm test` — all existing TypeScript tests pass (no regressions)
    5. If pools were found: each `poolAddress` matches `/^0x[0-9a-fA-F]{40}$/`
    6. If no pools found: `ARBITRUM_SEPOLIA_POOLS` is `[]` with documentation comment
  </verify>
  <done>
    - Zero instances of "TBD_DISCOVER_ON_CHAIN" in pool config file
    - Zero instances of "0x...0001" fake token address in pool config file
    - Zero instances of "0x000...0" placeholder in tokens config (either real address or entry removed)
    - TypeScript compiles cleanly
    - All existing tests pass
    - Pool addresses are either valid Ethereum addresses discovered from on-chain factory queries, or the array is empty with documented reason
  </done>
</task>

</tasks>

<verification>
## Phase 3 Gap Closure Verification

After this plan completes, re-run the Phase 3 verification checks:

1. **SC-3 check:** If pools were found, the bot can now be started and PriceMonitor will attempt real RPC calls to valid pool addresses. If pools array is empty, the bot starts in idle mode (existing behavior, well-handled).

2. **SC-5 check:** If pools were found and have liquidity, dry-run mode can detect and report opportunities. If no pools, SC-5 remains blocked but the gap is now "testnet has no liquidity" (infrastructure limitation) not "config has placeholder strings" (code bug).

3. **No regressions:** `pnpm test` passes, `forge test` unaffected (no Solidity changes).

The key distinction: the gap changes from "invalid placeholder strings that crash PriceMonitor" to either "real pools that work" or "empty array that the bot handles gracefully." Both are valid closures of the verification gap.
</verification>

<success_criteria>
1. `bot/src/config/chains/pools/arbitrum-sepolia.ts` contains zero placeholder strings (TBD_DISCOVER_ON_CHAIN, 0x...0001)
2. `bot/src/config/chains/arbitrum-sepolia.ts` tokens section has no zero-address placeholders
3. All pool addresses are either valid Ethereum addresses or the array is empty with documentation
4. TypeScript compilation succeeds
5. All existing tests pass without modification
</success_criteria>

<output>
After completion, create `.planning/phases/03-bot-adaptation/03-04-SUMMARY.md`
</output>
