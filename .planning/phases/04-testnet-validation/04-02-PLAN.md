---
phase: 04-testnet-validation
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - bot/src/config/chains/arbitrum-sepolia.ts
autonomous: true

must_haves:
  truths:
    - "All Solidity tests pass (312 tests, 0 failures)"
    - "All TypeScript tests pass (450+ tests, 0 failures)"
    - "No test regressions from any Phase 4 config changes (e.g., delta threshold adjustment)"
  artifacts:
    - path: "bot/src/config/chains/arbitrum-sepolia.ts"
      provides: "Arbitrum Sepolia chain configuration"
      contains: "deltaThresholdPercent"
  key_links:
    - from: "bot/__tests__/config/chain-config.test.ts"
      to: "bot/src/config/chains/arbitrum-sepolia.ts"
      via: "import and assertion"
      pattern: "ARBITRUM_SEPOLIA_CONFIG"
---

<objective>
Run the full test suite to confirm all existing tests pass after any Phase 4 changes, satisfying TEST-04.

Purpose: Prevent regressions from config changes made during the live bot run (e.g., delta threshold adjustment). This is a standard CI gate that ensures the 762 existing tests (312 Solidity + 450 TypeScript) remain green.

Output: Test run results with pass/fail counts documented.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-testnet-validation/04-01-SUMMARY.md
@bot/src/config/chains/arbitrum-sepolia.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Run full Solidity test suite</name>
  <files>contracts/test/</files>
  <action>
Run the complete Solidity test suite using Foundry. All 312 tests must pass with 0 failures.

```bash
forge test
```

If any test fails:
1. Check if the failure is related to a Phase 4 config change (unlikely â€” Solidity tests don't read TypeScript configs)
2. If unrelated to Phase 4: This is a pre-existing issue. Document and proceed.
3. If related to Phase 4: Fix the issue before proceeding.

Expected output: `312 tests passed, 0 failed` (or current equivalent count).
  </action>
  <verify>
Run `forge test` and confirm output shows all tests passing with 0 failures.
  </verify>
  <done>All Solidity tests pass (312 tests, 0 failures). No regressions from Phase 4 changes.</done>
</task>

<task type="auto">
  <name>Task 2: Run full TypeScript test suite and reconcile config changes</name>
  <files>bot/src/config/chains/arbitrum-sepolia.ts</files>
  <action>
Run the complete TypeScript test suite using Vitest. All 450+ tests must pass with 0 failures.

```bash
pnpm test
```

**If `deltaThresholdPercent` was changed in Plan 04-01 Task 3 (from 0.01 to 0.001):**

Check whether the chain config tests assert on the exact threshold value:
```bash
grep -n "deltaThresholdPercent" bot/__tests__/config/chain-config.test.ts
```

If a test asserts `deltaThresholdPercent === 0.01` and it was changed to `0.001`, update the test assertion to match, OR revert the threshold back to `0.01` if the live run is complete and the lower value is no longer needed.

**Decision logic:**
- If the 1-hour run completed successfully with the lower threshold: Keep `0.001` and update the test assertion.
- If the original threshold `0.01` is preferred for production: Revert to `0.01` (no test changes needed).

After resolving any threshold mismatch, re-run:
```bash
pnpm test
```

Expected output: `450+ tests passed, 0 failed` (current count is 450).
  </action>
  <verify>
Run `pnpm test` and confirm output shows all tests passing with 0 failures. If config changes were made, verify the chain-config tests reflect the final threshold value.
  </verify>
  <done>All TypeScript tests pass (450+ tests, 0 failures). Any Phase 4 config changes are reconciled with test assertions. TEST-04 is satisfied.</done>
</task>

</tasks>

<verification>
After both tasks complete, verify:

1. **Solidity tests:** `forge test` shows 312+ tests passing, 0 failures
2. **TypeScript tests:** `pnpm test` shows 450+ tests passing, 0 failures
3. **Config reconciliation:** If `deltaThresholdPercent` was changed during Plan 04-01, the final value in `arbitrum-sepolia.ts` matches the test assertions
4. **No new test files needed:** Phase 4 is validation-only; no new test files should be created
</verification>

<success_criteria>
- `forge test` passes with 312+ tests, 0 failures
- `pnpm test` passes with 450+ tests, 0 failures
- Any config changes from Plan 04-01 are reconciled with test expectations
- TEST-04 requirement is satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/04-testnet-validation/04-02-SUMMARY.md`
</output>
