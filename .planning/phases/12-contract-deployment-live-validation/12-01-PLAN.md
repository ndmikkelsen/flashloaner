---
phase: 12-contract-deployment-live-validation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - deployments/42161.json
  - broadcast/Deploy.s.sol/42161/run-latest.json
autonomous: false
requirements: [EXEC-01]

must_haves:
  truths:
    - "FlashloanExecutor is deployed to Arbitrum mainnet and verified on Arbiscan"
    - "UniswapV3Adapter, SushiSwap adapters, and TraderJoeLBAdapter are registered with the executor"
    - "Bot wallet (deployer) is authorized to call executeArbitrage on the executor"
    - "Deployed addresses are recorded in deployments/42161.json"
  artifacts:
    - path: "deployments/42161.json"
      provides: "All deployed contract addresses on Arbitrum mainnet"
      contains: "FlashloanExecutor"
    - path: "broadcast/Deploy.s.sol/42161/run-latest.json"
      provides: "Foundry broadcast receipt with transaction hashes"
  key_links:
    - from: "FlashloanExecutor"
      to: "Aave V3 Pool (0x794a61358D6845594F94dc1DB02A252b5b4814aD)"
      via: "Constructor parameter"
    - from: "FlashloanExecutor"
      to: "Balancer Vault (0xBA12222222228d8Ba445958a75a0704d566BF2C8)"
      via: "Constructor parameter"
    - from: "FlashloanExecutor"
      to: "All adapters"
      via: "registerAdapter() calls"
---

<objective>
Deploy FlashloanExecutor and all DEX adapters to Arbitrum mainnet using the existing Deploy.s.sol script, verify contracts on Arbiscan, and record deployed addresses.

Purpose: Get on-chain infrastructure live so the bot can simulate and execute real arbitrage trades.
Output: Verified contracts on Arbitrum mainnet + deployments/42161.json with all addresses.
</objective>

<execution_context>
@/Users/naynay/.claude/get-shit-done/workflows/execute-plan.md
@/Users/naynay/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@contracts/script/Deploy.s.sol
@bot/src/config/chains/arbitrum.ts
</context>

<tasks>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 1: Fund deployer wallet and set environment variables</name>
  <action>
Ensure the deployer wallet has sufficient ETH for deployment gas on Arbitrum.

**1. Check deployer wallet balance:**
```bash
cast balance 0x8d7a596F072e462E7b018747e62EC8eB01191a18 --rpc-url $ARBITRUM_RPC_URL
```
You need approximately 0.01-0.05 ETH for deployment (Arbitrum gas is cheap).

**2. Set environment variables in your terminal (NOT in .env files that get committed):**
```bash
# Required for deployment
export DEPLOYER_PRIVATE_KEY="<your deployer private key>"
export BOT_WALLET_ADDRESS="0x8d7a596F072e462E7b018747e62EC8eB01191a18"

# Arbitrum protocol addresses
export AAVE_V3_POOL="0x794a61358D6845594F94dc1DB02A252b5b4814aD"
export BALANCER_VAULT="0xBA12222222228d8Ba445958a75a0704d566BF2C8"

# Arbitrum DEX routers (from bot/src/config/chains/arbitrum.ts)
export UNISWAP_V3_ROUTER="0x68b3465833fb72A70ecDF485E0e4C7bD8665Fc45"
export UNISWAP_V3_QUOTER="0x61fFE014bA17989E743c5F6cB21bF9697530B21e"
export SUSHISWAP_V2_ROUTER="0x1b02dA8Cb0d097eB8D57A175b88c7D8b47997506"

# Trader Joe LBRouter V2.1 on Arbitrum
export TRADERJOE_LB_ROUTER="0xb4315e873dBcf96Ffd0acd8EA43f689D8c20fB30"

# Safety parameters (conservative for initial deployment)
export MIN_PROFIT_WEI="10000000000000000"   # 0.01 ETH
export MAX_GAS_PRICE="100000000000"          # 100 gwei (Arbitrum gas is usually 0.01-0.1 gwei, this is a safety cap)
export MAX_TRADE_SIZE="1000000000000000000000" # 1000 ETH
export FAILURE_THRESHOLD="5"
```

**Note:** UNISWAP_V2_ROUTER is NOT set because Uniswap V2 was never deployed on Arbitrum. The script handles this gracefully (skips UniswapV2Adapter deployment). SUSHISWAP_V3_ROUTER and SUSHISWAP_V3_QUOTER are also not set since Sushi V3 on Arbitrum uses different contracts — we skip SushiSwapV3Adapter for now.
  </action>
  <verify>
Run `echo $DEPLOYER_PRIVATE_KEY | wc -c` to confirm the key is set (should output ~67, the length of a hex private key + newline). Run `cast balance $BOT_WALLET_ADDRESS --rpc-url $ARBITRUM_RPC_URL` to confirm balance > 0.01 ETH.
  </verify>
  <done>Deployer wallet funded with > 0.01 ETH on Arbitrum and all environment variables set in the terminal session.</done>
</task>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 2: Dry-run deployment on Arbitrum fork</name>
  <action>
Before broadcasting, run the deployment script in simulation mode (no --broadcast) to verify everything works.

**Run from the project root directory:**
```bash
set -a && source .env && set +a  # Load RPC URL if in .env

forge script contracts/script/Deploy.s.sol:Deploy \
  --rpc-url $ARBITRUM_RPC_URL \
  -vvv
```

**Expected output:**
- Pre-deployment summary showing Arbitrum chain ID (42161)
- All safety contracts deployed (CircuitBreaker, ProfitValidator)
- FlashloanExecutor deployed
- UniswapV3Adapter deployed
- SushiSwapV2Adapter deployed (uses UniswapV2Adapter with Sushi router)
- TraderJoeLBAdapter deployed
- UniswapV2Adapter SKIPPED (no Uniswap V2 on Arbitrum)
- All adapters registered
- Configuration checks passed
- Deployment addresses printed

**If the dry run fails:**
- "DEPLOYER_PRIVATE_KEY not set" → re-export the env var
- "AAVE_V3_POOL not set" → re-export protocol addresses
- Compilation errors → run `forge build` first to check
  </action>
  <verify>
Dry-run completes without errors. The console shows "DEPLOYMENT SUCCESSFUL" and prints all deployed addresses. No "Deploy:" require failures.
  </verify>
  <done>Dry-run deployment simulates successfully on Arbitrum fork, all adapters deployed and registered.</done>
</task>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 3: Broadcast deployment to Arbitrum mainnet</name>
  <action>
Now broadcast the actual deployment transactions to Arbitrum mainnet.

**Deploy with --broadcast and --verify:**
```bash
forge script contracts/script/Deploy.s.sol:Deploy \
  --rpc-url $ARBITRUM_RPC_URL \
  --broadcast \
  --verify \
  --slow \
  --etherscan-api-key $ARBISCAN_API_KEY \
  -vvv
```

**Flags explained:**
- `--broadcast`: Actually send transactions (not simulation)
- `--verify`: Automatically verify contracts on Arbiscan
- `--slow`: Wait for each transaction to be mined before sending next (safer)
- `--etherscan-api-key`: Required for Arbiscan verification

**After deployment, the script will:**
1. Print all deployed contract addresses
2. Save deployment JSON to `deployments/42161.json`
3. Save broadcast receipt to `broadcast/Deploy.s.sol/42161/run-latest.json`

**Record the FlashloanExecutor address** — you will need it as EXECUTOR_ADDRESS for the bot.

**If verification fails** (common — Arbiscan rate limits):
```bash
# Manually verify each contract
forge verify-contract <EXECUTOR_ADDRESS> contracts/src/FlashloanExecutor.sol:FlashloanExecutor \
  --chain arbitrum \
  --etherscan-api-key $ARBISCAN_API_KEY \
  --constructor-args $(cast abi-encode "constructor(address,address,address,address,uint256)" \
    0x794a61358D6845594F94dc1DB02A252b5b4814aD \
    0xBA12222222228d8Ba445958a75a0704d566BF2C8 \
    0x8d7a596F072e462E7b018747e62EC8eB01191a18 \
    0x8d7a596F072e462E7b018747e62EC8eB01191a18 \
    10000000000000000)
```
  </action>
  <verify>
1. Check `deployments/42161.json` exists and contains valid addresses (not zero addresses for core contracts).
2. Check FlashloanExecutor on Arbiscan: `https://arbiscan.io/address/<EXECUTOR_ADDRESS>` — should show verified contract source.
3. Run: `cast call <EXECUTOR_ADDRESS> "owner()" --rpc-url $ARBITRUM_RPC_URL` — should return deployer address.
4. Run: `cast call <EXECUTOR_ADDRESS> "botWallet()" --rpc-url $ARBITRUM_RPC_URL` — should return bot wallet address.
  </verify>
  <done>FlashloanExecutor and all adapters deployed to Arbitrum mainnet with verified source on Arbiscan. Addresses saved in deployments/42161.json.</done>
</task>

</tasks>

<verification>
1. `cat deployments/42161.json` shows valid contract addresses for FlashloanExecutor, UniswapV3Adapter, SushiSwapV2Adapter (UniswapV2Adapter), and TraderJoeLBAdapter
2. `cast call <EXECUTOR_ADDRESS> "owner()" --rpc-url $ARBITRUM_RPC_URL` returns deployer address
3. `cast call <EXECUTOR_ADDRESS> "botWallet()" --rpc-url $ARBITRUM_RPC_URL` returns bot wallet address
4. `cast call <EXECUTOR_ADDRESS> "paused()" --rpc-url $ARBITRUM_RPC_URL` returns false (not paused)
5. Arbiscan shows verified contract source for FlashloanExecutor
</verification>

<success_criteria>
FlashloanExecutor and all DEX adapters are deployed to Arbitrum mainnet (chain ID 42161), verified on Arbiscan, and the deployment JSON is saved locally. The executor is configured with Aave V3 and Balancer as flash loan providers, and all adapter contracts are registered.
</success_criteria>

<output>
After completion, create `.planning/phases/12-contract-deployment-live-validation/12-01-SUMMARY.md`
</output>
