---
phase: 12-contract-deployment-live-validation
plan: 03
type: execute
wave: 3
depends_on: [12-02]
files_modified: []
autonomous: false
requirements: [EXEC-01, EXEC-02]

must_haves:
  truths:
    - "Bot runs in live mode and submits real transactions to Arbitrum mainnet"
    - "Bot executes at least one profitable arbitrage trade on mainnet"
    - "Trade outcomes are persisted to .data/trades.jsonl with three-bucket P&L"
    - "Bot operates with safety guards active (staleness, circuit breaker, profit validator)"
  artifacts:
    - path: ".data/trades.jsonl"
      provides: "Persisted trade outcomes with P&L data"
      contains: "txHash"
  key_links:
    - from: "bot/src/index.ts (live mode)"
      to: "FlashloanExecutor (on-chain)"
      via: "ExecutionEngine.executeTransaction()"
    - from: "FlashloanExecutor"
      to: "ProfitValidator"
      via: "On-chain profit check before completing flashloan"
---

<objective>
Switch the bot from shadow mode to live mode and execute real arbitrage trades on Arbitrum mainnet, achieving at least one profitable trade.

Purpose: Complete the v1.1 milestone by proving the system can profitably execute arbitrage trades on mainnet with real capital.
Output: At least one profitable trade on Arbiscan + trade data in .data/trades.jsonl.
</objective>

<execution_context>
@/Users/naynay/.claude/get-shit-done/workflows/execute-plan.md
@/Users/naynay/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-contract-deployment-live-validation/12-02-SUMMARY.md
@bot/src/run-arb-mainnet.ts
@bot/src/index.ts
</context>

<tasks>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 1: Fund wallet and switch to live mode</name>
  <action>
**IMPORTANT: Only proceed after shadow mode validation is complete (Plan 12-02).**

**1. Ensure the deployer wallet has ETH for gas:**
```bash
cast balance 0x8d7a596F072e462E7b018747e62EC8eB01191a18 --rpc-url $RPC_URL
```
You need ETH for gas costs. Each failed arbitrage transaction costs ~$0.01-0.05 on Arbitrum (L2 execution + L1 data). Start with at least 0.05 ETH for gas to handle a few failed attempts.

Note: The bot uses flash loans (Aave V3 / Balancer) for trade capital, so you do NOT need to fund the wallet with trading capital — only gas.

**2. Switch environment to live mode:**
```bash
# Execution mode: LIVE (real transactions)
export DRY_RUN="false"
export SHADOW_MODE="false"

# All other env vars remain the same from shadow mode:
# RPC_URL, PRIVATE_KEY, EXECUTOR_ADDRESS, ADAPTER_* addresses
```

**3. Start the bot in live mode:**
```bash
cd bot
node --import tsx src/run-arb-mainnet.ts
```

**Expected startup output:**
```
  Flashloan Bot v1.1.0 — ARBITRUM ONE
  Mode:     LIVE
  Chain:    Arbitrum One (chainId 42161)
```

**Or use pm2 for unattended operation:**
```bash
# Update ecosystem.config.cjs to set DRY_RUN=false, SHADOW_MODE=false
pm2 start ecosystem.config.cjs
pm2 logs flashloan-bot --lines 50
```

**4. What happens in live mode:**
- Bot monitors pools (same as dry-run and shadow)
- When a profitable opportunity is detected:
  1. Staleness guard checks latency < 200ms
  2. NonceManager acquires next nonce (crash-safe)
  3. TransactionBuilder encodes the arbitrage calldata
  4. Gas is estimated (L2 execution + L1 data fee)
  5. Transaction is signed and submitted to Arbitrum sequencer
  6. ExecutionEngine waits for confirmation
  7. On-chain: FlashloanExecutor borrows via flash loan, swaps through adapters, repays loan, keeps profit
  8. On-chain: ProfitValidator ensures profit exceeds minProfit (0.01 ETH), reverts if not
  9. Outcome is logged and persisted to .data/trades.jsonl

**Safety guarantees:**
- Flash loans: zero capital risk (loan reverts atomically if unprofitable)
- ProfitValidator: on-chain check prevents completing unprofitable trades
- CircuitBreaker: auto-pauses after 5 consecutive failures
- Staleness guard: aborts if price data > 200ms old
- The ONLY capital at risk is gas for failed/reverted transactions (~$0.01-0.05 each on Arbitrum)
  </action>
  <verify>
Bot starts in LIVE mode (check startup banner shows "Mode: LIVE"). No startup errors. First price update appears within 10 seconds.
  </verify>
  <done>Bot running in live mode on Arbitrum mainnet, ready to execute real arbitrage trades.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Monitor live trades and validate first profitable execution</name>
  <action>
Monitor the bot for trade execution. This may take hours depending on market conditions.

**1. Watch for trade attempts in logs:**
```bash
# If using pm2
pm2 logs flashloan-bot --lines 200

# Look for these key log lines:
# "Submitting transaction..." — bot is broadcasting
# "Transaction confirmed" — trade landed on chain
# "Transaction reverted" — trade failed (expected sometimes)
# "Staleness abort" — price too old, skipped (expected)
```

**2. Check trade history:**
```bash
# View persisted trades
cat .data/trades.jsonl | tail -5

# Or use the report command
cd bot && node --import tsx src/run-arb-mainnet.ts --report
```

**3. Verify on Arbiscan:**
When you see a "Transaction confirmed" log with a txHash:
- Visit: `https://arbiscan.io/tx/<txHash>`
- Verify the transaction succeeded (green checkmark)
- Check token transfers — you should see flash loan borrow, swap(s), and repay

**4. Check P&L:**
After one or more trades, review the three-bucket P&L:
```bash
# Quick P&L check from trade store
cat .data/trades.jsonl | wc -l  # total trades
```

The startup stats display will also show lifetime P&L on next restart.

**If no opportunities are executing after many hours:**
- Check that shadow mode was finding opportunities (if shadow found them, live should too)
- Check gas estimates — if estimated gas cost exceeds estimated profit, the bot correctly skips
- Review the min profit threshold (0.01 ETH may be too high for current market; can lower via MIN_PROFIT_WEI)
- Check CircuitBreaker state: `cast call <EXECUTOR_ADDRESS> "paused()" --rpc-url $RPC_URL` (if true, call unpause())

**If transactions are reverting:**
- Check revert reason in Arbiscan transaction details
- Common reasons: slippage exceeded (market moved), insufficient liquidity, stale prices
- Some reverts are normal — the safety system catches them. Only worry if ALL trades revert.
  </action>
  <verify>
At least one transaction submitted and confirmed on Arbitrum mainnet. At least one trade net-profitable (grossProfit > gasCost + l1DataFee). Trade data persisted in .data/trades.jsonl. Type "live validated" with trade results (count, P&L, any txHash examples), or describe issues encountered.
  </verify>
  <done>Bot executed at least one profitable live trade on Arbitrum mainnet, with trade outcome persisted to .data/trades.jsonl.</done>
</task>

</tasks>

<verification>
1. Bot operated in LIVE mode on Arbitrum mainnet
2. At least one real transaction was submitted and confirmed on-chain
3. At least one trade was net-profitable (visible in .data/trades.jsonl or --report output)
4. Trade outcomes persisted with three-bucket P&L (grossProfit, gasCost, l1DataFee)
5. Bot operated stably with all safety guards active (staleness, circuit breaker, profit validator)
</verification>

<success_criteria>
Phase 12 is complete when the bot has executed at least one profitable live trade on Arbitrum mainnet. This validates the entire pipeline end-to-end: price monitoring, opportunity detection, optimal sizing, transaction building, flash loan execution, DEX swaps, and profit capture — all on real mainnet with real capital.
</success_criteria>

<output>
After completion, create `.planning/phases/12-contract-deployment-live-validation/12-03-SUMMARY.md`
</output>
