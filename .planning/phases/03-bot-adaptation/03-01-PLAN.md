---
phase: 03-bot-adaptation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - bot/src/config/chains/arbitrum-sepolia.ts
  - bot/src/config/chains/pools/arbitrum-sepolia.ts
  - bot/src/run-arb-sepolia.ts
  - package.json
autonomous: true

must_haves:
  truths:
    - "Bot connects to Arbitrum Sepolia via RPC and reads block number"
    - "Chain config returns correct WETH address and Uniswap V3 factory for Arbitrum Sepolia"
    - "Bot loads pool definitions from ARBITRUM_SEPOLIA_CONFIG.pools"
    - "pnpm bot:arb-sepolia script exists and launches the Arbitrum Sepolia entry point"
  artifacts:
    - path: "bot/src/config/chains/arbitrum-sepolia.ts"
      provides: "Corrected Arbitrum Sepolia config with real token addresses and Uniswap V3 factory"
      contains: "0x980B62Da83eFf3D4576C647993b0c1D7faf17c73"
    - path: "bot/src/config/chains/pools/arbitrum-sepolia.ts"
      provides: "Pool definitions for Arbitrum Sepolia testnet"
      contains: "ARBITRUM_SEPOLIA_POOLS"
    - path: "bot/src/run-arb-sepolia.ts"
      provides: "Arbitrum Sepolia entry point using loadChainConfig(421614)"
      contains: "loadChainConfig"
    - path: "package.json"
      provides: "bot:arb-sepolia script command"
      contains: "bot:arb-sepolia"
  key_links:
    - from: "bot/src/run-arb-sepolia.ts"
      to: "bot/src/config/chains/index.ts"
      via: "loadChainConfig(421614)"
      pattern: "loadChainConfig\\(421614\\)"
    - from: "bot/src/run-arb-sepolia.ts"
      to: "bot/src/index.ts"
      via: "new FlashloanBot(config)"
      pattern: "new FlashloanBot"
    - from: "bot/src/config/chains/arbitrum-sepolia.ts"
      to: "bot/src/config/chains/pools/arbitrum-sepolia.ts"
      via: "import ARBITRUM_SEPOLIA_POOLS"
      pattern: "ARBITRUM_SEPOLIA_POOLS"
---

<objective>
Fix the Arbitrum Sepolia chain config (wrong factory address, placeholder tokens, empty pools) and create a dedicated entry point that connects the bot to Arbitrum Sepolia using `loadChainConfig(421614)`.

Purpose: Without correct addresses and a working entry point, the bot cannot connect to Arbitrum Sepolia or monitor any pools. This is the foundation for all other Phase 3 work (BOT-01, BOT-02, BOT-03).

Output: Working `run-arb-sepolia.ts` entry point, corrected chain config, populated pool definitions.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-bot-adaptation/03-RESEARCH.md
@bot/src/config/chains/arbitrum-sepolia.ts
@bot/src/config/chains/pools/arbitrum-sepolia.ts
@bot/src/config/chains/index.ts
@bot/src/config/chains/types.ts
@bot/src/config/types.ts
@bot/src/run-testnet.ts
@bot/src/index.ts
@deployments/421614.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix Arbitrum Sepolia config addresses and populate pool definitions</name>
  <files>
    bot/src/config/chains/arbitrum-sepolia.ts
    bot/src/config/chains/pools/arbitrum-sepolia.ts
  </files>
  <action>
    **In `bot/src/config/chains/arbitrum-sepolia.ts`:**

    1. Fix the Uniswap V3 factory address. The current value `0x1F98431c8aD98523631AE4a59f267346ea31F984` is the Ethereum mainnet/Arbitrum mainnet address. On Arbitrum Sepolia, the factory is at `0x248AB79Bbb9bC29bB72f7Cd42F17e054Fc40188e` (from official Uniswap V3 deployment docs).

    2. Fix the Uniswap V3 router. Use SwapRouter02 for Arbitrum Sepolia: `0x101F443B4d1b059569D643917553c771E1b9663E`.

    3. Fix the Uniswap V3 quoter. Use QuoterV2 for Arbitrum Sepolia: `0x2779a0CC1c3e0E44D2542EC3e79e3864Ae93Ef0B`.

    4. Update the WETH token address from `0x000...0` to the confirmed address: `0x980B62Da83eFf3D4576C647993b0c1D7faf17c73` (verified from Uniswap V3 Arbitrum Sepolia deployment docs and Arbiscan Sepolia).

    5. Keep USDC and USDT as `0x000...0` with a comment that they need on-chain discovery. These testnet tokens have no canonical address. The pool definitions below will use actual pool addresses discovered from factory.

    6. Add a comment on each corrected address citing the source (e.g., "Uniswap V3 Arbitrum Sepolia deployment docs").

    **In `bot/src/config/chains/pools/arbitrum-sepolia.ts`:**

    7. Add placeholder pool definitions that the entry point can use for testnet monitoring. Since Arbitrum Sepolia testnet has sparse liquidity and pools may not exist yet, define at least 2 placeholder `PoolDefinition` entries for WETH-paired pools using the Uniswap V3 factory address. Use `dex: "uniswap_v3"` and the confirmed WETH address.

    8. Add a factory query helper comment block showing how to discover live pools using `factory.getPool(token0, token1, fee)` — this is for the developer to run manually to find actual pool addresses.

    9. The pool entries should use realistic fee tiers (500 = 0.05%, 3000 = 0.3%) and mark pool addresses as `"TBD_DISCOVER_ON_CHAIN"` with a prominent comment. The bot entry point will check for zero pools and warn at startup. This is acceptable for Phase 3 — the pools will be populated when a developer runs the discovery script or manually queries the factory.

    **Important:** Do NOT add @arbitrum/sdk as a dependency. All work uses ethers.js v6 directly.
  </action>
  <verify>
    Run `pnpm test` to confirm existing tests pass (no regressions from config changes). Verify that `loadChainConfig(421614)` in an import test returns the config with the corrected factory address `0x248AB79Bbb9bC29bB72f7Cd42F17e054Fc40188e` and WETH address `0x980B62Da83eFf3D4576C647993b0c1D7faf17c73`.
  </verify>
  <done>
    ARBITRUM_SEPOLIA_CONFIG has correct Uniswap V3 factory (`0x248AB7...`), confirmed WETH address (`0x980B62...`), corrected router and quoter addresses. ARBITRUM_SEPOLIA_POOLS has placeholder pool definitions or discovery helper. All existing tests pass.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create run-arb-sepolia.ts entry point and package.json script</name>
  <files>
    bot/src/run-arb-sepolia.ts
    package.json
  </files>
  <action>
    **Create `bot/src/run-arb-sepolia.ts`:**

    Follow the pattern from `run-testnet.ts` but use `loadChainConfig(421614)` instead of hardcoded Sepolia constants.

    1. `import "dotenv/config"` MUST be the very first import (before any other imports). This ensures `process.env.RPC_URL` is populated before `ARBITRUM_SEPOLIA_CONFIG` evaluates `process.env.RPC_URL`.

    2. Import `loadChainConfig` from `./config/index.js` and call `loadChainConfig(421614)`.

    3. Import `FlashloanBot, BOT_VERSION` from `./index.js`.

    4. Import `ArbitrageOpportunity` from `./detector/types.js`, `PriceSnapshot, PriceDelta` from `./monitor/types.js`.

    5. Create a `Stats` interface and `stats` object identical to `run-testnet.ts`.

    6. In `main()`:
       - Load chain config: `const chain = loadChainConfig(421614);`
       - Print startup header showing chain name, chain ID, RPC status (configured/MISSING), pool count, WETH address from `chain.tokens.WETH`.
       - Guard: if `!chain.rpcUrl`, print error and exit.
       - Construct `FlashloanBot` directly (NOT `fromEnv()`):
         ```typescript
         const bot = new FlashloanBot({
           network: { rpcUrl: chain.rpcUrl, chainId: chain.chainId },
           pools: chain.pools,
           monitor: chain.monitor,
           detector: chain.detector,
           logLevel: (process.env.LOG_LEVEL as "debug" | "info" | "warn" | "error") ?? "debug",
         });
         ```
       - Wire event listeners for `priceUpdate`, `opportunityFound`, `opportunityRejected`, `error`, `stale` — mirror `run-testnet.ts` patterns.
       - Add stats interval (60s).
       - Add graceful shutdown (SIGINT, SIGTERM).
       - After `bot.start()`, check `chain.pools.length === 0` and warn if no pools configured.

    7. Call `main().catch(...)` at bottom.

    **Update `package.json`:**

    8. Add a new script: `"bot:arb-sepolia": "node --import tsx bot/src/run-arb-sepolia.ts"`. Place it next to the existing bot-related scripts. Match the pattern used by other scripts in package.json (this project uses `tsx`, NOT `ts-node`).

    **Key difference from `run-testnet.ts`:** This entry point does NOT use `FlashloanBot.fromEnv()`. It constructs `FlashloanBot` directly with chain config values, avoiding the default config path that hardcodes Ethereum/Sepolia values.
  </action>
  <verify>
    1. `pnpm test` passes (no regressions).
    2. TypeScript compiles without errors: `npx tsc --noEmit --project bot/tsconfig.json` (or equivalent).
    3. Verify `package.json` has the `bot:arb-sepolia` script entry.
    4. The file `bot/src/run-arb-sepolia.ts` exists and imports `loadChainConfig`.
  </verify>
  <done>
    `run-arb-sepolia.ts` exists, uses `loadChainConfig(421614)`, constructs `FlashloanBot` directly with chain config, has event listeners, stats tracking, and graceful shutdown. `package.json` has `bot:arb-sepolia` script. All existing tests pass.
  </done>
</task>

</tasks>

<verification>
1. `pnpm test` — all 423 TypeScript tests pass
2. `forge test` — all 312 Solidity tests pass (no Solidity changes, but verify no regressions)
3. `loadChainConfig(421614)` returns config with corrected addresses
4. `bot/src/run-arb-sepolia.ts` exists and TypeScript-compiles without errors
5. `package.json` contains `bot:arb-sepolia` script
</verification>

<success_criteria>
- Arbitrum Sepolia config has correct Uniswap V3 factory address (not the Ethereum mainnet one)
- WETH token address is `0x980B62Da83eFf3D4576C647993b0c1D7faf17c73` (not zero)
- Entry point creates FlashloanBot using loadChainConfig(421614) and chain-specific settings
- Entry point warns if no pools configured or RPC URL missing
- All existing tests pass without modification
</success_criteria>

<output>
After completion, create `.planning/phases/03-bot-adaptation/03-01-SUMMARY.md`
</output>
